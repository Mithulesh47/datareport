<div class="container">

    <!-- ðŸ”¹ Left Side: Add Form -->
    <div class="left-form">
        <form [formGroup]="sprintForm" (ngSubmit)="addSprint()" class="form-container">
            <mat-card>
                <mat-card-title>Add New Sprint</mat-card-title>
                <mat-card-content>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Sprint Name</mat-label>
                        <input matInput formControlName="sprintName" />
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Sprint Start Date</mat-label>
                        <input matInput [matDatepicker]="picker1" formControlName="sprintStartDate" />
                        <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                        <mat-datepicker #picker1></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Sprint End Date</mat-label>
                        <input matInput [matDatepicker]="picker2" formControlName="sprintEndDate" />
                        <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                        <mat-datepicker #picker2></mat-datepicker>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Sprint JIRA</mat-label>
                        <input matInput formControlName="sprintJira" />
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Sprint Description</mat-label>
                        <textarea matInput formControlName="sprintDescription"></textarea>
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Assigned To</mat-label>
                        <input matInput formControlName="assignedTo" />
                    </mat-form-field>

                    <mat-form-field appearance="outline" class="full-width">
                        <mat-label>Status</mat-label>
                        <mat-select formControlName="sprintFor">
                            <mat-option *ngFor="let status of statusList" [value]="status">{{ status.statusName
                                }}</mat-option>
                        </mat-select>
                    </mat-form-field>

                </mat-card-content>

                <mat-card-actions>
                    <button mat-raised-button color="primary" type="submit"
                        [disabled]="sprintForm.invalid">Submit</button>
                </mat-card-actions>
            </mat-card>
        </form>

        <!-- ðŸ”˜ Toggle Chart Button -->
        <div style="margin-top: 16px; text-align: left;">
            <button mat-stroked-button color="accent" (click)="showChart = !showChart">
                {{ showChart ? 'Hide' : 'Show' }} Project Progress
            </button>
        </div>

        <!-- ðŸ“ˆ Chart Display -->
        <div *ngIf="showChart" style="margin-top: 24px;">
            <app-sprint-progress-chart [sprints]="sprints"></app-sprint-progress-chart>
        </div>
    </div>

    <!-- ðŸ”¸ Right Side: Sprint Cards -->
    <div class="right-list">
        <h3>List of Sprints:</h3>

        <div *ngFor="let sprint of sprints; let i = index" class="sprint-card">
            <mat-card>
                <ng-container *ngIf="editIndex !== i; else editCard">
                    <mat-card-title>{{ sprint.sprintName }}</mat-card-title>
                    <mat-card-content>
                        <p><strong>Start:</strong> {{ sprint.sprintStartDate | date }}</p>
                        <p><strong>End:</strong> {{ sprint.sprintEndDate | date }}</p>
                        <p><strong>JIRA:</strong> {{ sprint.sprintJira }}</p>
                        <p><strong>Description:</strong> {{ sprint.sprintDescription }}</p>
                        <p><strong>Assigned To:</strong> {{ sprint.assignedTo }}</p>
                        <p><strong>Status:</strong> {{ sprint.sprintFor?.statusName }}</p>
                    </mat-card-content>
                    <mat-card-actions align="end">
                        <button mat-icon-button color="primary" (click)="enableEdit(i)">
                            <mat-icon>edit</mat-icon>
                        </button>
                        <button mat-icon-button color="warn" (click)="confirmDelete(i)">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </mat-card-actions>
                </ng-container>

                <ng-template #editCard>
                    <form [formGroup]="editForm" (ngSubmit)="saveEdit(i)" class="edit-form">

                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Sprint Name</mat-label>
                            <input matInput formControlName="sprintName" />
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Sprint Start Date</mat-label>
                            <input matInput [matDatepicker]="editPicker1" formControlName="sprintStartDate" />
                            <mat-datepicker-toggle matSuffix [for]="editPicker1"></mat-datepicker-toggle>
                            <mat-datepicker #editPicker1></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Sprint End Date</mat-label>
                            <input matInput [matDatepicker]="editPicker2" formControlName="sprintEndDate" />
                            <mat-datepicker-toggle matSuffix [for]="editPicker2"></mat-datepicker-toggle>
                            <mat-datepicker #editPicker2></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Sprint JIRA</mat-label>
                            <input matInput formControlName="sprintJira" />
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Sprint Description</mat-label>
                            <textarea matInput formControlName="sprintDescription"></textarea>
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Assigned To</mat-label>
                            <input matInput formControlName="assignedTo" />
                        </mat-form-field>

                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Status</mat-label>
                            <mat-select formControlName="sprintFor">
                                <mat-option *ngFor="let status of statusList" [value]="status">{{ status.statusName
                                    }}</mat-option>
                            </mat-select>
                        </mat-form-field>

                        <mat-card-actions align="end">
                            <button mat-raised-button color="primary" type="submit"
                                [disabled]="editForm.invalid">Save</button>
                            <button mat-button type="button" (click)="cancelEdit()">Cancel</button>
                        </mat-card-actions>
                    </form>
                </ng-template>

            </mat-card>
        </div>

    </div>

</div>